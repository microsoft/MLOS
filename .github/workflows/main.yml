# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the main branch
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  windows-msbuild-debug:
    name: Run debug msbuild on Windows
    runs-on: windows-2019
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2
    # Runs a multiple commands using the runners shell
    - name: Run debug msbuild
      shell: cmd
      run: |
        set Configuration=Debug
        scripts\build.windows.cmd

  windows-msbuild-release:
    name: Run release msbuild on Windows
    runs-on: windows-2019
    steps:
    - uses: actions/checkout@v2
    - name: Run release msbuild
      shell: cmd
      run: |
        set Configuration=Release
        scripts\build.windows.cmd

  python-licenseheader-checks:
    name: Check for license header comments on python files
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v2
    - name: Run licenseheaders tool and check to see if it caused any changes
      shell: bash
      run: |
        sudo apt -y install python3-pip
        pip3 install licenseheaders
        scripts/update-python-license-headers
        # Note: licenseheader currently rewrites the line-endings from crlf to lf,
        # so we instruct git-diff to ignore those when considering changes.
        git --no-pager diff --ignore-cr-at-eol --exit-code

  python-lint-checks:
    name: Run python lint checks
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v2
    - name: Run python checks
      shell: bash
      run: |
        sudo apt -y install pylint
        scripts/run-python-checks

#  python-unit-tests:
#    name:
#    runs-on: ubuntu-20.04
#    steps:
#    - uses: actions/checkout@v2
#    - name: Run python unit tests
#      shell: bash
#      run: |
#        # TODO:
