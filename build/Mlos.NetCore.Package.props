<?xml version="1.0" encoding="utf-8"?>
<!--
  This file effectively takes the place of a number of .nuspec declarations
  so that we can build directly with .csproj files using "dotnet pack".
-->
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!--
    Set some .nuspec style properties
    Note: The Copyright property also comes from the Mlos.NetCore.Version.props file.
  -->
  <PropertyGroup>
    <PackageProjectUrl>https://github.com/Microsoft/MLOS</PackageProjectUrl>
    <RepositoryUrl>https://github.com/Microsoft/MLOS.git</RepositoryUrl>
    <RepositoryType>git</RepositoryType>
    <Authors>Microsoft</Authors>
    <PackageRequireLicenseAcceptance>false</PackageRequireLicenseAcceptance>
    <PackageLicenseExpression>MIT</PackageLicenseExpression>
    <PackageTags>MLOS;Machine Learning;Optimization;Systems</PackageTags>
  </PropertyGroup>

  <!-- Unless specified on the commandline, set the default package output to the target/ dir. -->
  <PropertyGroup>
    <MlosPkgOutputBaseDir>$(BaseDir)/target/pkg</MlosPkgOutputBaseDir>
    <MlosPkgOutputDir>$(MlosPkgOutputBaseDir)/$(Configuration)</MlosPkgOutputDir>
    <PackageOutputPath>$(MlosPkgOutputDir)/</PackageOutputPath>
  </PropertyGroup>

  <!-- Also create a .snupkg along side the package for eventual publishing of symbols to nuget.org -->
  <PropertyGroup>
    <IncludeSymbols>true</IncludeSymbols>
    <!--
      When this property is omitted disabled, we a separate .symbols.nupkg file is created
      that includes both the .dll and .pdb.
    -->
    <SymbolPackageFormat>snupkg</SymbolPackageFormat>
  </PropertyGroup>

  <!-- Include the .pdb symbols file in the standard package to make debugging easier. -->
  <PropertyGroup>
    <AllowedOutputExtensionsInPackageBuildOutputFolder>$(AllowedOutputExtensionsInPackageBuildOutputFolder);.pdb</AllowedOutputExtensionsInPackageBuildOutputFolder>
  </PropertyGroup>

  <PropertyGroup>
<!-- TODO: Remove this (or fix it's dependencies) - it forces a Build target dependency so doesn't work with NoBuild. -->
    <!--Include Project References output -->
    <!--
    <TargetsForTfmSpecificBuildOutput>$(TargetsForTfmSpecificBuildOutput);CopyProjectReferencesToPackage</TargetsForTfmSpecificBuildOutput>
    -->
  </PropertyGroup>

<!-- TODO: Remove this (or fix it's dependencies) - it forces a Build target dependency so doesn't work with NoBuild. -->
  <Target DependsOnTargets="ResolveReferences" Name="CopyProjectReferencesToPackage">
    <ItemGroup>
      <!--Include DLLs of Project References -->
      <BuildOutputInPackage Include="@(ReferenceCopyLocalPaths->WithMetadataValue('ReferenceSourceTarget', 'ProjectReference'))"/>

      <!--Include PDBs of Project References -->
      <BuildOutputInPackage Include="@(ReferenceCopyLocalPaths->WithMetadataValue('ReferenceSourceTarget', 'ProjectReference')->Replace('.dll', '.pdb'))"/>
    </ItemGroup>
  </Target>

  <!--
    Note: PackTask alters the PackageVersion property slightly when writing the file,
    (e.g. dropping the "+{commitNumber}") so it is difficult to provide a "clean" target
    for removing packages. For now, just remove the target/pkg/... directory/files.
  -->
</Project>
