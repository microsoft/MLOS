<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Note: We can't call this before/after the "Build" target since it would result in dependency loops. -->
  <!-- Not named "Publish" to avoid a clash with the "dotnet publish" command. -->
  <Target Name="PublishNetCoreProjectBinary" AfterTargets="PublishProjectBinary">
    <PropertyGroup>
      <RuntimeId Condition="'$(IsLinux)' == 'true'">linux-x64</RuntimeId>
      <RuntimeId Condition="'$(IsWindows)' == 'true'">win-x64</RuntimeId>
      <!--PublishDir>$(BaseDir)/target/bin/$(Configuration)</PublishDir-->
      <PublishDir>$(BinplaceDir)</PublishDir>
    </PropertyGroup>
    <MakeDir Directories="$(PublishDir)" />
    <!-- This re-executes a build with a runtime defined, which in turn requires a fresh restore -->
    <!-- Done this way so that cmake, make, dotnet, and msbuild invokations can all get the same result. -->
    <Exec Command="dotnet publish --configuration=$(Configuration) --runtime=$(RuntimeId) --output=$(PublishDir) $(MSBuildProjectFullPath)" />
  </Target>
</Project>
